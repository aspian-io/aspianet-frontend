!function(){"use strict";let e;let t=e=>{let t=e,r=e=>{t=e};return{get:()=>t,set:r}};var r=tinymce.util.Tools.resolve("tinymce.PluginManager");let o=e=>{let t=()=>e.get();return{isEnabled:t}},n=(e,t)=>e.dispatch("VisualChars",{state:t}),l=(e,t,r)=>{var o;return!!r(e,t.prototype)||(null===(o=e.constructor)||void 0===o?void 0:o.name)===t.name},s=e=>{let t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&l(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t},a=e=>t=>typeof t===e,i=e=>"string"===s(e),u=e=>null===e,d=a("boolean"),c=e=>null==e,h=e=>!c(e),m=a("number");class g{constructor(e,t){this.tag=e,this.value=t}static some(e){return new g(!0,e)}static none(){return g.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?g.some(e(this.value)):g.none()}bind(e){return this.tag?e(this.value):g.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:g.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return h(e)?g.some(e):g.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}g.singletonNone=new g(!1);let v=(e,t)=>{let r=e.length,o=Array(r);for(let n=0;n<r;n++){let l=e[n];o[n]=t(l,n)}return o},f=(e,t)=>{for(let r=0,o=e.length;r<o;r++){let n=e[r];t(n,r)}},p=(e,t)=>{let r=[];for(let o=0,n=e.length;o<n;o++){let l=e[o];t(l,o)&&r.push(l)}return r},y=Object.keys,b=(e,t)=>{let r=y(e);for(let o=0,n=r.length;o<n;o++){let l=r[o],s=e[l];t(s,l)}};"undefined"!=typeof window?window:Function("return this;")();let N=e=>e.dom.nodeType,w=e=>e.dom.nodeValue,k=e=>3===N(e),T=(e,t,r)=>{if(i(r)||d(r)||m(r))e.setAttribute(t,r+"");else throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",r,":: Element ",e),Error("Attribute value was not simple")},A=(e,t,r)=>{T(e.dom,t,r)},C=(e,t)=>{let r=e.dom.getAttribute(t);return null===r?void 0:r},E=(e,t)=>{e.dom.removeAttribute(t)},L=(e,t)=>{let r=C(e,t);return void 0===r||""===r?[]:r.split(" ")},O=(e,t,r)=>{let o=L(e,t),n=o.concat([r]);return A(e,t,n.join(" ")),!0},x=(e,t,r)=>{let o=p(L(e,t),e=>e!==r);return o.length>0?A(e,t,o.join(" ")):E(e,t),!1},B=e=>void 0!==e.dom.classList,S=e=>L(e,"class"),V=(e,t)=>O(e,"class",t),D=(e,t)=>x(e,"class",t),j=(e,t)=>{B(e)?e.dom.classList.add(t):V(e,t)},M=e=>{let t=B(e)?e.dom.classList:S(e);0===t.length&&E(e,"class")},_=(e,t)=>{if(B(e)){let r=e.dom.classList;r.remove(t)}else D(e,t);M(e)},P=(e,t)=>{let r=(t||document).createElement("div");if(r.innerHTML=e,!r.hasChildNodes()||r.childNodes.length>1){let o="HTML does not have a single root node";throw console.error(o,e),Error(o)}return I(r.childNodes[0])},F=(e,t)=>{let r=(t||document).createElement(e);return I(r)},H=(e,t)=>{let r=(t||document).createTextNode(e);return I(r)},I=e=>{if(null==e)throw Error("Node cannot be null or undefined");return{dom:e}},K=(e,t,r)=>g.from(e.dom.elementFromPoint(t,r)).map(I),R={fromHtml:P,fromTag:F,fromText:H,fromDom:I,fromPoint:K},U={"\xa0":"nbsp","\xad":"shy"},$=(e,t)=>{let r="";return b(e,(e,t)=>{r+=t}),RegExp("["+r+"]",t?"g":"")},q=$(U),z=$(U,!0),G=(e="",b(U,t=>{e&&(e+=","),e+="span.mce-"+t}),e),J="mce-nbsp",Q=e=>'<span data-mce-bogus="1" class="mce-'+U[e]+'">'+e+"</span>",W=e=>{let t=w(e);return k(e)&&i(t)&&q.test(t)},X=(e,t)=>{let r=[],o=e.dom,n=v(o.childNodes,R.fromDom);return f(n,e=>{t(e)&&(r=r.concat([e])),r=r.concat(X(e,t))}),r},Y=(e,t)=>{for(;e.parentNode;){if(e.parentNode===t)return t;e=e.parentNode}},Z=e=>e.replace(z,Q),ee=e=>"span"===e.nodeName.toLowerCase()&&e.classList.contains("mce-nbsp-wrap"),et=(e,t)=>{let r=e.dom,o=X(R.fromDom(t),W);f(o,t=>{var o;let n=t.dom.parentNode;if(ee(n))j(R.fromDom(n),J);else{let l;let s=Z(r.encode(null!==(o=w(t))&&void 0!==o?o:"")),a=r.create("div",{},s);for(;l=a.lastChild;)r.insertAfter(l,t.dom);e.dom.remove(t.dom)}})},er=(e,t)=>{let r=e.dom.select(G,t);f(r,t=>{ee(t)?_(R.fromDom(t),J):e.dom.remove(t,!0)})},eo=e=>{let t=e.getBody(),r=e.selection.getBookmark(),o=Y(e.selection.getNode(),t);er(e,o=void 0!==o?o:t),et(e,o),e.selection.moveToBookmark(r)},en=(e,t)=>{n(e,t.get());let r=e.getBody();!0===t.get()?et(e,r):er(e,r)},el=(e,t)=>{t.set(!t.get());let r=e.selection.getBookmark();en(e,t),e.selection.moveToBookmark(r)},es=(e,t)=>{e.addCommand("mceVisualChars",()=>{el(e,t)})},ea=e=>{let t=e.options.register;t("visualchars_default_state",{processor:"boolean",default:!1})},ei=e=>e.options.get("visualchars_default_state"),eu=(e,t)=>{e.on("init",()=>{en(e,t)})},ed=(e,t)=>{let r=null,o=()=>{u(r)||(clearTimeout(r),r=null)},n=(...o)=>{u(r)&&(r=setTimeout(()=>{r=null,e.apply(null,o)},t))};return{cancel:o,throttle:n}},ec=(e,t)=>{let r=ed(()=>{eo(e)},300);e.on("keydown",o=>{!0===t.get()&&(13===o.keyCode?eo(e):r.throttle())}),e.on("remove",r.cancel)},eh=(e,t)=>r=>{r.setActive(t.get());let o=e=>r.setActive(e.state);return e.on("VisualChars",o),()=>e.off("VisualChars",o)},em=(e,t)=>{let r=()=>e.execCommand("mceVisualChars");e.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:r,onSetup:eh(e,t)}),e.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:r,onSetup:eh(e,t)})};r.add("visualchars",e=>{ea(e);let r=t(ei(e));return es(e,r),em(e,r),ec(e,r),eu(e,r),o(r)})}();