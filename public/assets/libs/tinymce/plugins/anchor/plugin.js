!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),a=tinymce.util.Tools.resolve("tinymce.util.Tools");let o=e=>{let t=e.options.register;t("allow_html_in_named_anchor",{processor:"boolean",default:!1})},n=e=>e.options.get("allow_html_in_named_anchor"),r="a:not([href])",l=e=>!e,i=e=>{let t=e.getAttribute("id")||e.getAttribute("name");return t||""},d=e=>"a"===e.nodeName.toLowerCase(),s=e=>d(e)&&!e.getAttribute("href")&&""!==i(e),c=e=>s(e)&&!e.firstChild,m=e=>{let o=e.dom;t(o).walk(e.selection.getRng(),e=>{a.each(e,e=>{c(e)&&o.remove(e,!1)})})},u=e=>/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(e),h=e=>e.dom.getParent(e.selection.getStart(),r),g=e=>{let t=h(e);return t?i(t):""},p=(e,t)=>{e.undoManager.transact(()=>{n(e)||e.selection.collapse(!0),e.selection.isCollapsed()?e.insertContent(e.dom.createHTML("a",{id:t})):(m(e),e.formatter.remove("namedAnchor",void 0,void 0,!0),e.formatter.apply("namedAnchor",{value:t}),e.addVisual())})},b=(e,t,a)=>{a.removeAttribute("name"),a.id=t,e.addVisual(),e.undoManager.add()},y=(e,t)=>{let a=h(e);a?b(e,t,a):p(e,t),e.focus()},f=(e,t)=>u(t)?(y(e,t),!0):(e.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1),v=e=>{let t=g(e);e.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:t},onSubmit:t=>{f(e,t.getData().id)&&t.close()}})},A=e=>{e.addCommand("mceAnchor",()=>{v(e)})},w=e=>l(e.attr("href"))&&!l(e.attr("id")||e.attr("name")),C=e=>w(e)&&!e.firstChild,_=e=>t=>{for(let a=0;a<t.length;a++){let o=t[a];C(o)&&o.attr("contenteditable",e)}},M=e=>{e.on("PreInit",()=>{e.parser.addNodeFilter("a",_("false")),e.serializer.addNodeFilter("a",_(null))})},T=e=>{e.formatter.register("namedAnchor",{inline:"a",selector:r,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(e,t,a)=>s(e)})},k=e=>{let t=()=>e.execCommand("mceAnchor");e.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:t,onSetup:t=>e.selection.selectorChangedWithUnbind("a:not([href])",t.setActive).unbind}),e.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:t})};e.add("anchor",e=>{o(e),M(e),A(e),k(e),e.on("PreInit",()=>{T(e)})})}();