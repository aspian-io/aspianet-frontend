!function(){"use strict";var e,t=tinymce.util.Tools.resolve("tinymce.PluginManager");let r=e=>t=>e===t,o=r(null),n=r(void 0),l=e=>null==e,s=e=>!l(e),a=()=>{},i=()=>!1;class u{constructor(e,t){this.tag=e,this.value=t}static some(e){return new u(!0,e)}static none(){return u.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?u.some(e(this.value)):u.none()}bind(e){return this.tag?e(this.value):u.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:u.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return s(e)?u.some(e):u.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}u.singletonNone=new u(!1);let c=(e,t)=>{for(let r=0,o=e.length;r<o;r++){let o=e[r];if(t(o,r))return!0}return!1},g=(e,t)=>{let r=e.length,o=Array(r);for(let n=0;n<r;n++){let r=e[n];o[n]=t(r,n)}return o},m=(e,t)=>{for(let r=0,o=e.length;r<o;r++){let o=e[r];t(o,r)}},h=e=>{let t=e,r=e=>{t=e};return{get:()=>t,set:r}},d=(e,t)=>{let r=null,n=()=>{o(r)||(clearTimeout(r),r=null)},l=(...o)=>{n(),r=setTimeout(()=>{r=null,e.apply(null,o)},t)};return{cancel:n,throttle:l}},p=(e,t)=>{e.insertContent(t)},y=Object.keys,f=Object.hasOwnProperty,v=(e,t)=>{let r=y(e);for(let o=0,n=r.length;o<n;o++){let n=r[o],l=e[n];t(l,n)}},b=(e,t)=>_(e,(e,r)=>({k:r,v:t(e,r)})),_=(e,t)=>{let r={};return v(e,(e,o)=>{let n=t(e,o);r[n.k]=n.v}),r},j=(e,t)=>f.call(e,t),w=(e=(e,t)=>t,(...t)=>{if(0===t.length)throw Error("Can't merge zero objects");let r={};for(let o=0;o<t.length;o++){let n=t[o];for(let t in n)j(n,t)&&(r[t]=e(r[t],n[t]))}return r}),C=e=>{let t=h(u.none()),r=()=>t.get().each(e),o=()=>{r(),t.set(u.none())},n=()=>t.get().isSome(),l=()=>t.get(),s=e=>{r(),t.set(u.some(e))};return{clear:o,isSet:n,get:l,set:s}},k=()=>{let e=C(a),t=t=>e.get().each(t);return{...e,on:t}},A=(e,t,r)=>""===t||e.length>=t.length&&e.substr(r,r+t.length)===t,O=(e,t,r=0,o)=>{let l=e.indexOf(t,r);return -1!==l&&(!!n(o)||l+t.length<=o)},x=(e,t)=>A(e,t,0);var T=tinymce.util.Tools.resolve("tinymce.Resource");let D=e=>t=>t.options.get(e),E=(e,t)=>{let r=e.options.register;r("emoticons_database",{processor:"string",default:"emojis"}),r("emoticons_database_url",{processor:"string",default:`${t}/js/${L(e)}${e.suffix}.js`}),r("emoticons_database_id",{processor:"string",default:"tinymce.plugins.emoticons"}),r("emoticons_append",{processor:"object",default:{}}),r("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})},L=D("emoticons_database"),N=D("emoticons_database_url"),P=D("emoticons_database_id"),S=D("emoticons_append"),$=D("emoticons_images_url"),F={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},I=(e,t)=>j(e,t)?e[t]:t,z=e=>{let t=S(e);return b(t,e=>({keywords:[],category:"user",...e}))},M=(e,t,r)=>{let o=k(),n=k(),l=$(e),s=e=>x(e.char,"<img")?e.char.replace(/src="([^"]+)"/,(e,t)=>`src="${l}${t}"`):e.char,a=e=>{let t={},r=[];v(e,(e,o)=>{let n={title:o,keywords:e.keywords,char:s(e),category:I(F,e.category)},l=void 0!==t[n.category]?t[n.category]:[];t[n.category]=l.concat([n]),r.push(n)}),o.set(t),n.set(r)};e.on("init",()=>{T.load(r,t).then(t=>{let r=z(e);a(w(t,r))},e=>{console.log(`Failed to load emojis: ${e}`),o.set({}),n.set([])})});let i=e=>"All"===e?c():o.get().bind(t=>u.from(t[e])).getOr([]),c=()=>n.get().getOr([]),g=()=>["All"].concat(y(o.get().getOr({}))),m=()=>h()?Promise.resolve(!0):new Promise((e,r)=>{let o=15,n=setInterval(()=>{h()?(clearInterval(n),e(!0)):--o<0&&(console.log("Could not load emojis from url: "+t),clearInterval(n),r(!1))},100)}),h=()=>o.isSet()&&n.isSet();return{listCategories:g,hasLoaded:h,waitForLoad:m,listAll:c,listCategory:i}},R=(e,t)=>O(e.title.toLowerCase(),t)||c(e.keywords,e=>O(e.toLowerCase(),t)),U=(e,t,r)=>{let o=[],n=t.toLowerCase(),l=r.fold(()=>i,e=>t=>t>=e);for(let r=0;r<e.length&&!((0===t.length||R(e[r],n))&&(o.push({value:e[r].char,text:e[r].title,icon:e[r].char}),l(o.length)));r++);return o},B="pattern",q=(e,t)=>{let r={pattern:"",results:U(t.listAll(),"",u.some(300))},o=h("All"),n=e=>{let r=e.getData(),n=o.get(),l=t.listCategory(n),s=U(l,r[B],"All"===n?u.some(300):u.none());e.setData({results:s})},l=d(e=>{n(e)},200),s={label:"Search",type:"input",name:B},a={type:"collection",name:"results"},i=()=>{let n={type:"tabpanel",tabs:g(t.listCategories(),e=>({title:e,name:e,items:[s,a]}))};return{title:"Emojis",size:"normal",body:n,initialData:r,onTabChange:(e,t)=>{o.set(t.newTabName),l.throttle(e)},onChange:l.throttle,onAction:(t,r)=>{"results"===r.name&&(p(e,r.value),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},c=e.windowManager.open(i());c.focus(B),t.hasLoaded()||(c.block("Loading emojis..."),t.waitForLoad().then(()=>{c.redial(i()),l.throttle(c),c.focus(B),c.unblock()}).catch(e=>{c.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),c.focus(B),c.unblock()}))},G=(e,t)=>{e.addCommand("mceEmoticons",()=>q(e,t))},H=e=>{e.on("PreInit",()=>{e.parser.addAttributeFilter("data-emoticon",e=>{m(e,e=>{e.attr("data-mce-resize","false"),e.attr("data-mce-placeholder","1")})})})},J=(e,t)=>{e.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(e,r)=>t.waitForLoad().then(()=>{let o=t.listAll();return U(o,e,u.some(r))}),onAction:(t,r,o)=>{e.selection.setRng(r),e.insertContent(o),t.hide()}})},K=e=>{let t=()=>e.execCommand("mceEmoticons");e.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:t}),e.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:t})};t.add("emoticons",(e,t)=>{E(e,t);let r=N(e),o=P(e),n=M(e,r,o);G(e,n),K(e),J(e,n),H(e)})}();