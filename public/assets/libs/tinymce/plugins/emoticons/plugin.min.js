!function(){"use strict";var t,e=tinymce.util.Tools.resolve("tinymce.PluginManager");let r=t=>e=>t===e,o=r(null),n=r(void 0),l=()=>{},s=()=>!1;class a{constructor(t,e){this.tag=t,this.value=e}static some(t){return new a(!0,t)}static none(){return a.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?a.some(t(this.value)):a.none()}bind(t){return this.tag?t(this.value):a.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:a.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw Error(null!=t?t:"Called getOrDie on None")}static from(t){return null==t?a.none():a.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}a.singletonNone=new a(!1);let i=(t,e)=>{let r=t.length,o=Array(r);for(let n=0;n<r;n++){let l=t[n];o[n]=e(l,n)}return o},u=t=>{let e=t;return{get:()=>e,set:t=>{e=t}}},c=Object.keys,g=Object.hasOwnProperty,m=(t,e)=>{let r=c(t);for(let o=0,n=r.length;o<n;o++){let l=r[o];e(t[l],l)}},h=(t,e)=>g.call(t,e),d=(t=(t,e)=>e,(...e)=>{if(0===e.length)throw Error("Can't merge zero objects");let r={};for(let o=0;o<e.length;o++){let n=e[o];for(let l in n)h(n,l)&&(r[l]=t(r[l],n[l]))}return r}),p=()=>{let t=(t=>{let e=u(a.none()),r=()=>e.get().each(t);return{clear:()=>{r(),e.set(a.none())},isSet:()=>e.get().isSome(),get:()=>e.get(),set:t=>{r(),e.set(a.some(t))}}})(l);return{...t,on:e=>t.get().each(e)}},y=(t,e,r=0,o)=>{let l=t.indexOf(e,r);return -1!==l&&(!!n(o)||l+e.length<=o)};var v=tinymce.util.Tools.resolve("tinymce.Resource");let f=t=>e=>e.options.get(t),b=f("emoticons_database"),_=f("emoticons_database_url"),w=f("emoticons_database_id"),j=f("emoticons_append"),C=f("emoticons_images_url"),A={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},k=(t,e)=>h(t,e)?t[e]:e,O=t=>{var e;let r=j(t);return e=t=>({keywords:[],category:"user",...t}),((t,e)=>{let r={};return m(t,(t,o)=>{let n=e(t,o);r[n.k]=n.v}),r})(r,(t,r)=>({k:r,v:e(t)}))},x=(t,e)=>y(t.title.toLowerCase(),e)||((t,r)=>{for(let o=0,n=t.length;o<n;o++)if(y(t[o].toLowerCase(),e))return!0;return!1})(t.keywords),L=(t,e,r)=>{let o=[],n=e.toLowerCase(),l=r.fold(()=>s,t=>e=>e>=t);for(let a=0;a<t.length&&(0!==e.length&&!x(t[a],n)||(o.push({value:t[a].char,text:t[a].title,icon:t[a].char}),!l(o.length)));a++);return o},T="pattern",D=(t,e)=>{let r={pattern:"",results:L(e.listAll(),"",a.some(300))},n=u("All"),l=((t,e)=>{let r=null,n=()=>{o(r)||(clearTimeout(r),r=null)};return{cancel:n,throttle:(...e)=>{n(),r=setTimeout(()=>{r=null,t.apply(null,e)},200)}}})(t=>{(t=>{let r=t.getData(),o=n.get(),l=e.listCategory(o),s=L(l,r.pattern,"All"===o?a.some(300):a.none());t.setData({results:s})})(t)}),s={label:"Search",type:"input",name:T},c={type:"collection",name:"results"},g=()=>({title:"Emojis",size:"normal",body:{type:"tabpanel",tabs:i(e.listCategories(),t=>({title:t,name:t,items:[s,c]}))},initialData:r,onTabChange:(t,e)=>{n.set(e.newTabName),l.throttle(t)},onChange:l.throttle,onAction:(e,r)=>{"results"===r.name&&(((t,e)=>{t.insertContent(e)})(t,r.value),e.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}),m=t.windowManager.open(g());m.focus(T),e.hasLoaded()||(m.block("Loading emojis..."),e.waitForLoad().then(()=>{m.redial(g()),l.throttle(m),m.focus(T),m.unblock()}).catch(t=>{m.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),m.focus(T),m.unblock()}))};e.add("emoticons",(t,e)=>{((t,e)=>{let r=t.options.register;r("emoticons_database",{processor:"string",default:"emojis"}),r("emoticons_database_url",{processor:"string",default:`${e}/js/${b(t)}${t.suffix}.js`}),r("emoticons_database_id",{processor:"string",default:"tinymce.plugins.emoticons"}),r("emoticons_append",{processor:"object",default:{}}),r("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})})(t,e);let r=((t,e,r)=>{let o=p(),n=p(),l=C(t),s=t=>{var e,r;return r="<img",(e=t.char).length>=r.length&&e.substr(0,0+r.length)===r?t.char.replace(/src="([^"]+)"/,(t,e)=>`src="${l}${e}"`):t.char};t.on("init",()=>{v.load(r,e).then(e=>{let r=O(t);(t=>{let e={},r=[];m(t,(t,o)=>{let n={title:o,keywords:t.keywords,char:s(t),category:k(A,t.category)},l=void 0!==e[n.category]?e[n.category]:[];e[n.category]=l.concat([n]),r.push(n)}),o.set(e),n.set(r)})(d(e,r))},t=>{console.log(`Failed to load emojis: ${t}`),o.set({}),n.set([])})});let i=()=>n.get().getOr([]),u=()=>o.isSet()&&n.isSet();return{listCategories:()=>["All"].concat(c(o.get().getOr({}))),hasLoaded:u,waitForLoad:()=>u()?Promise.resolve(!0):new Promise((t,r)=>{let o=15,n=setInterval(()=>{u()?(clearInterval(n),t(!0)):--o<0&&(console.log("Could not load emojis from url: "+e),clearInterval(n),r(!1))},100)}),listAll:i,listCategory:t=>"All"===t?i():o.get().bind(e=>a.from(e[t])).getOr([])}})(t,_(t),w(t));((t,e)=>{t.addCommand("mceEmoticons",()=>D(t,e))})(t,r),(t=>{let e=()=>t.execCommand("mceEmoticons");t.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:e}),t.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:e})})(t),((t,e)=>{t.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(t,r)=>e.waitForLoad().then(()=>{let o=e.listAll();return L(o,t,a.some(r))}),onAction:(e,r,o)=>{t.selection.setRng(r),t.insertContent(o),e.hide()}})})(t,r),(t=>{t.on("PreInit",()=>{t.parser.addAttributeFilter("data-emoticon",t=>{((t,e)=>{var r;for(let o=0,n=t.length;o<n;o++)(r=t[o]).attr("data-mce-resize","false"),r.attr("data-mce-placeholder","1")})(t)})})})(t)})}();