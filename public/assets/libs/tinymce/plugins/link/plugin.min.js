!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let t=e=>t=>(e=>{var t,n;let l=typeof e;return null===e?"null":"object"===l&&Array.isArray(e)?"array":"object"===l&&((t=String).prototype.isPrototypeOf(e)||(null===(n=e.constructor)||void 0===n?void 0:n.name)===t.name)?"string":l})(t)===e,n=e=>t=>typeof t===e,l=t("string"),r=t("object"),o=t("array"),a=e=>null===e,i=n("boolean"),s=e=>null!=e,u=n("function"),c=(e,t)=>{if(o(e)){for(let n=0,l=e.length;n<l;++n)if(!t(e[n]))return!1;return!0}return!1},g=()=>{},d=(e,t)=>e===t;class m{constructor(e,t){this.tag=e,this.value=t}static some(e){return new m(!0,e)}static none(){return m.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?m.some(e(this.value)):m.none()}bind(e){return this.tag?e(this.value):m.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:m.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return s(e)?m.some(e):m.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}m.singletonNone=new m(!1);let h=Array.prototype.indexOf,f=Array.prototype.push,p=e=>{let t=[];for(let n=0,l=e.length;n<l;++n){if(!o(e[n]))throw Error("Arr.flatten item "+n+" was not an array, input: "+e);f.apply(t,e[n])}return t},k=(e,t)=>{for(let n=0;n<e.length;n++){let l=t(e[n],n);if(l.isSome())return l}return m.none()},v=(e,t,n=d)=>e.exists(e=>n(e,t)),y=e=>{let t=[],n=e=>{t.push(e)};for(let l=0;l<e.length;l++)e[l].each(n);return t},x=(e,t)=>e?m.some(t):m.none(),b=e=>t=>t.options.get(e),_=b("link_assume_external_targets"),w=b("link_context_toolbar"),C=b("link_list"),O=b("link_default_target"),N=b("link_default_protocol"),A=b("link_target_list"),S=b("link_rel_list"),T=b("link_class_list"),E=b("link_title"),P=b("allow_unsafe_link_target"),R=b("link_quicklink");var L=tinymce.util.Tools.resolve("tinymce.util.Tools");let M=e=>l(e.value)?e.value:"",D=(e,t)=>{let n=[];return L.each(e,e=>{let r=l(e.text)?e.text:l(e.title)?e.title:"";if(void 0!==e.menu){let o=D(e.menu,t);n.push({text:r,items:o})}else{let a=t(e);n.push({text:r,value:a})}}),n},B=(e=M)=>t=>m.from(t).map(t=>D(t,e)),I=e=>B(M)(e),j=(e,t)=>n=>({name:e,type:"listbox",label:t,items:n}),K=Object.keys,U=Object.hasOwnProperty,q=(e,t)=>U.call(e,t);var F=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),V=tinymce.util.Tools.resolve("tinymce.util.URI");let $=e=>s(e)&&"a"===e.nodeName.toLowerCase(),z=e=>$(e)&&!!J(e),G=(e,t)=>{if(e.collapsed)return[];{let n=e.cloneContents(),l=n.firstChild,r=new F(l,n),o=[],a=l;do t(a)&&o.push(a);while(a=r.next());return o}},H=e=>/^\w+:/i.test(e),J=e=>{var t,n;return null!==(n=null!==(t=e.getAttribute("data-mce-href"))&&void 0!==t?t:e.getAttribute("href"))&&void 0!==n?n:""},W=(e,t)=>{var n;let l=["noopener"],r=e?e.split(/\s+/):[],o=e=>e.filter(e=>-1===L.inArray(l,e)),a=t?(n=o(n=r)).length>0?n.concat(l):l:o(r);return a.length>0?L.trim(a.sort().join(" ")):""},Q=(e,t)=>et(t=t||e.selection.getNode())?m.from(e.dom.select("a[href]",t)[0]):m.from(e.dom.getParent(t,"a[href]")),X=(e,t)=>Q(e,t).isSome(),Y=(e,t)=>t.fold(()=>e.getContent({format:"text"}),e=>e.innerText||e.textContent||"").replace(/\uFEFF/g,""),Z=e=>L.grep(e,z).length>0,ee=e=>{let t=e.schema.getTextInlineElements();if(Q(e).exists(e=>e.hasAttribute("data-mce-block")))return!1;let n=e.selection.getRng();return!!n.collapsed||0===G(n,e=>1===e.nodeType&&!$(e)&&!q(t,e.nodeName.toLowerCase())).length},et=e=>s(e)&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className),en=(e,t,n)=>{var l,r;let o=e.selection.getNode(),a=Q(e,o),i=((e,t)=>{var n,l;let r={...t};if(0===S(e).length&&!P(e)){let o=W(r.rel,"_blank"===r.target);r.rel=o||null}return m.from(r.target).isNone()&&!1===A(e)&&(r.target=O(e)),r.href=(n=r.href,"http"!==(l=_(e))&&"https"!==l||H(n)?n:l+"://"+n),r})(e,(l=(e,t)=>(n[t].each(n=>{e[t]=n.length>0?n:null}),e),r={href:n.href},((e,t)=>{for(let n=0,l=e.length;n<l;n++)t(e[n],n)})(["title","rel","class","target"],(e,t)=>{r=l(r,e)}),r));e.undoManager.transact(()=>{n.href===t.href&&t.attach(),a.fold(()=>{((e,t,n,l)=>{let r=e.dom;et(t)?ei(r,t,l):n.fold(()=>{e.execCommand("mceInsertLink",!1,l)},t=>{e.insertContent(r.createHTML("a",l,r.encode(t)))})})(e,o,n.text,i)},t=>{var l;e.focus(),l=t,n.text.each(e=>{q(l,"innerText")?l.innerText=e:l.textContent=e}),e.dom.setAttribs(l,i),e.selection.select(l)})})},el=e=>{let{class:t,href:n,rel:l,target:r,text:o,title:i}=e;return((e,t)=>{var n,l,r;let o={};return l=(e,t)=>!1===a(e),n=o,r=(e,t)=>{n[t]=e},((e,t)=>{let n=K(e);for(let l=0,r=n.length;l<r;l++){let o=n[l];t(e[o],o)}})(e,(e,t)=>{(l(e,t)?r:g)(e,t)}),o})({class:t.getOrNull(),href:n,rel:l.getOrNull(),target:r.getOrNull(),text:o.getOrNull(),title:i.getOrNull()})},er=(e,t,n)=>{let l=((e,t)=>{let n=e.options.get,l={allow_html_data_urls:n("allow_html_data_urls"),allow_script_urls:n("allow_script_urls"),allow_svg_data_urls:n("allow_svg_data_urls")},r=t.href;return{...t,href:V.isDomSafe(r,"a",l)?r:""}})(e,n);e.hasPlugin("rtc",!0)?e.execCommand("createlink",!1,el(l)):en(e,t,l)},eo=e=>{e.hasPlugin("rtc",!0)?e.execCommand("unlink"):(e=>{e.undoManager.transact(()=>{let t=e.selection.getNode();et(t)?ea(e,t):(e=>{let t=e.dom,n=e.selection,l=n.getBookmark(),r=n.getRng().cloneRange(),o=t.getParent(r.startContainer,"a[href]",e.getBody()),a=t.getParent(r.endContainer,"a[href]",e.getBody());o&&r.setStartBefore(o),a&&r.setEndAfter(a),n.setRng(r),e.execCommand("unlink"),n.moveToBookmark(l)})(e),e.focus()})})(e)},ea=(e,t)=>{var n;let l=e.dom.select("img",t)[0];if(l){let r=e.dom.getParents(l,"a[href]",t)[0];r&&(null===(n=r.parentNode)||void 0===n||n.insertBefore(l,r),e.dom.remove(r))}},ei=(e,t,n)=>{var l;let r=e.select("img",t)[0];if(r){let o=e.create("a",n);null===(l=r.parentNode)||void 0===l||l.insertBefore(o,r),o.appendChild(r)}},es=(e,t)=>k(t,t=>{var n;return q(t,n="items")&&void 0!==t[n]&&null!==t[n]?es(e,t.items):x(t.value===e,t)}),eu=(e,t)=>{let n={text:e.text,title:e.title},l=(e,l)=>{let r=("link"===l?t.link:"anchor"===l?t.anchor:m.none()).getOr([]);return((e,t,n,l)=>{let r=l[t],o=e.length>0;return void 0!==r?es(r,n).map(t=>({url:{value:t.value,meta:{text:o?e:t.text,attach:g}},text:o?e:t.text})):m.none()})(n.text,l,r,e)};return{onChange:(e,t)=>{let r=t.name;return"url"===r?(e=>{var t,l,r,o;let a=(t=e.url,x(n.text.length<=0,m.from(null===(l=t.meta)||void 0===l?void 0:l.text).getOr(t.value))),i=(r=e.url,x(n.title.length<=0,m.from(null===(o=r.meta)||void 0===o?void 0:o.title).getOr("")));return a.isSome()||i.isSome()?m.some({...a.map(e=>({text:e})).getOr({}),...i.map(e=>({title:e})).getOr({})}):m.none()})(e()):h.call(["anchor","link"],r)>-1?l(e(),r):(("text"===r||"title"===r)&&(n[r]=e()[r]),m.none())}}};var ec=tinymce.util.Tools.resolve("tinymce.util.Delay");let eg=e=>{let t=e.href;return t.indexOf("@")>0&&-1===t.indexOf("/")&&-1===t.indexOf("mailto:")?m.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:e=>({...e,href:"mailto:"+t})}):m.none()},ed=(e,t)=>n=>{let l=n.href;return 1===e&&!H(l)||0===e&&/^\s*www(\.|\d\.)/i.test(l)?m.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${t}:// prefix?`,preprocess:e=>({...e,href:t+"://"+l})}):m.none()},em=e=>{let t=e.dom.select("a:not([href])"),n=p(((e,t)=>{let n=e.length,l=Array(n);for(let r=0;r<n;r++){let o=e[r];l[r]=t(o,r)}return l})(t,e=>{let t=e.name||e.id;return t?[{text:t,value:"#"+t}]:[]}));return n.length>0?m.some([{text:"None",value:""}].concat(n)):m.none()},eh=e=>{let t=T(e);return t.length>0?I(t):m.none()},ef=e=>{try{return m.some(JSON.parse(e))}catch(t){return m.none()}},ep=(e,t)=>{let n=S(e);if(n.length>0){let l=v(t,"_blank"),r=e=>W(M(e),l);return(!1===P(e)?B(r):I)(n)}return m.none()},ek=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],ev=e=>{let t=A(e);return o(t)?I(t).orThunk(()=>m.some(ek)):!1===t?m.none():m.some(ek)},ey=(e,t,n)=>{let l=e.getAttrib(t,n);return null!==l&&l.length>0?m.some(l):m.none()},ex=(e,t)=>(e=>{let t=t=>e.convertURL(t.value||t.url||"","href"),n=C(e);return new Promise(e=>{l(n)?fetch(n).then(e=>e.ok?e.text().then(ef):Promise.reject()).then(e,()=>e(m.none())):u(n)?n(t=>e(m.some(t))):e(m.from(n))}).then(e=>e.bind(B(t)).map(e=>e.length>0?[{text:"None",value:""}].concat(e):e))})(e).then(n=>{let l=((e,t)=>{let n=e.dom,l=ee(e)?m.some(Y(e.selection,t)):m.none(),r=t.bind(e=>m.from(n.getAttrib(e,"href"))),o=t.bind(e=>m.from(n.getAttrib(e,"target"))),a=t.bind(e=>ey(n,e,"rel")),i=t.bind(e=>ey(n,e,"class"));return{url:r,text:l,title:t.bind(e=>ey(n,e,"title")),target:o,rel:a,linkClass:i}})(e,t);return{anchor:l,catalogs:{targets:ev(e),rels:ep(e,l.target),classes:eh(e),anchor:em(e),link:n},optNode:t,flags:{titleEnabled:E(e)}}}),eb=e=>{let t=(e=>{let t=Q(e);return ex(e,t)})(e);t.then(t=>{let n=n=>{let l=n.getData();if(!l.url.value)return eo(e),void n.close();let r=e=>m.from(l[e]).filter(n=>!v(t.anchor[e],n)),o={href:l.url.value,text:r("text"),target:r("target"),rel:r("rel"),class:r("linkClass"),title:r("title")},a={href:l.url.value,attach:void 0!==l.url.meta&&l.url.meta.attach?l.url.meta.attach:g};k([eg,ed(_(e),N(e))],e=>e(o)).fold(()=>Promise.resolve(o),t=>new Promise(n=>{((e,t,n)=>{let l=e.selection.getRng();ec.setEditorTimeout(e,()=>{e.windowManager.confirm(t,t=>{e.selection.setRng(l),n(t)})})})(e,t.message,e=>{n(e?t.preprocess(o):o)})})).then(t=>{er(e,a,t)}),n.close()};return((e,t,n)=>{let l=e.anchor.text.map(()=>({name:"text",type:"input",label:"Text to display"})).toArray(),r=e.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],o=((e,t)=>{let n=e.anchor,l=n.url.getOr("");return{url:{value:l,meta:{original:{value:l}}},text:n.text.getOr(""),title:n.title.getOr(""),anchor:l,link:l,rel:n.rel.getOr(""),target:n.target.or(t).getOr(""),linkClass:n.linkClass.getOr("")}})(e,m.from(O(n))),a=e.catalogs,i=eu(o,a);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:p([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],l,r,y([a.anchor.map(j("anchor","Anchors")),a.rels.map(j("rel","Rel")),a.targets.map(j("target","Open link in...")),a.link.map(j("link","Link list")),a.classes.map(j("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:o,onChange:(e,{name:t})=>{i.onChange(e.getData,{name:t}).each(t=>{e.setData(t)})},onSubmit:t}})(t,n,e)}).then(t=>{e.windowManager.open(t)})};var e_=tinymce.util.Tools.resolve("tinymce.util.VK");let ew=(e,t)=>e.dom.getParent(t,"a[href]"),eC=e=>ew(e,e.selection.getStart()),eO=(e,t)=>{if(t){let n=J(t);if(/^#/.test(n)){let l=e.dom.select(n);l.length&&e.selection.scrollIntoView(l[0],!0)}else(e=>{let t=document.createElement("a");t.target="_blank",t.href=e,t.rel="noreferrer noopener";let n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(t),t.dispatchEvent(n),document.body.removeChild(t)})(t.href)}},eN=e=>()=>{e.execCommand("mceLink",!1,{dialog:!0})},eA=e=>()=>{eO(e,eC(e))},eS=(e,t)=>(e.on("NodeChange",t),()=>e.off("NodeChange",t)),eT=e=>t=>{let n=()=>t.setActive(!e.mode.isReadOnly()&&X(e,e.selection.getNode()));return n(),eS(e,n)},eE=e=>t=>{let n=()=>t.setEnabled(X(e,e.selection.getNode()));return n(),eS(e,n)},eP=e=>t=>{let n=t=>Z(t)||G(e.selection.getRng(),z).length>0,l=e.dom.getParents(e.selection.getStart());return t.setEnabled(n(l)),eS(e,e=>t.setEnabled(n(e.parents)))};e.add("link",e=>{(e=>{let t=e.options.register;t("link_assume_external_targets",{processor:e=>{let t=l(e)||i(e);return t?!0===e?{value:1,valid:t}:"http"===e||"https"===e?{value:e,valid:t}:{value:0,valid:t}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),t("link_context_toolbar",{processor:"boolean",default:!1}),t("link_list",{processor:e=>l(e)||u(e)||c(e,r)}),t("link_default_target",{processor:"string"}),t("link_default_protocol",{processor:"string",default:"https"}),t("link_target_list",{processor:e=>i(e)||c(e,r),default:!0}),t("link_rel_list",{processor:"object[]",default:[]}),t("link_class_list",{processor:"object[]",default:[]}),t("link_title",{processor:"boolean",default:!0}),t("allow_unsafe_link_target",{processor:"boolean",default:!1}),t("link_quicklink",{processor:"boolean",default:!1})})(e),e.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:eN(e),onSetup:eT(e)}),e.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:eA(e),onSetup:eE(e)}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>eo(e),onSetup:eP(e)}),e.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:eA(e),onSetup:eE(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:eN(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>eo(e),onSetup:eP(e)}),(e=>{e.ui.registry.addContextMenu("link",{update:t=>Z(e.dom.getParents(t,"a"))?"link unlink openlink":"link"})})(e),(e=>{let t=t=>{let n=e.selection.getNode();return t.setEnabled(X(e,n)),g};e.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:eT(e)},label:"Link",predicate:t=>w(e)&&X(e,t),initValue:()=>Q(e).fold(()=>"",J),commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:t=>{let n=e.selection.getNode();return t.setActive(X(e,n)),eT(e)(t)},onAction:t=>{let n=t.getValue(),l=(t=>{let n=Q(e),l=ee(e);if(n.isNone()&&l){let r=Y(e.selection,n);return m.some(r.length>0?r:t)}return m.none()})(n);er(e,{href:n,attach:g},{href:n,text:l,title:m.none(),rel:m.none(),target:m.none(),class:m.none()}),(e=>{e.selection.collapse(!1)})(e),t.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:t,onAction:t=>{eo(e),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:t,onAction:t=>{eA(e)(),t.hide()}}]})})(e),e.on("click",t=>{let n=ew(e,t.target);n&&e_.metaKeyPressed(t)&&(t.preventDefault(),eO(e,n))}),e.on("keydown",t=>{var n;if(!t.isDefaultPrevented()&&13===t.keyCode&&!0===(n=t).altKey&&!1===n.shiftKey&&!1===n.ctrlKey&&!1===n.metaKey){let l=eC(e);l&&(t.preventDefault(),eO(e,l))}}),(e=>{e.addCommand("mceLink",(t,n)=>{!0!==(null==n?void 0:n.dialog)&&R(e)?e.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"}):eb(e)})})(e),(e=>{e.addShortcut("Meta+K","",()=>{e.execCommand("mceLink")})})(e)})}();