!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let t=(e,t,n)=>{var l;return!!n(e,t.prototype)||(null===(l=e.constructor)||void 0===l?void 0:l.name)===t.name},n=e=>{let n=typeof e;return null===e?"null":"object"===n&&Array.isArray(e)?"array":"object"===n&&t(e,String,(e,t)=>t.isPrototypeOf(e))?"string":n},l=e=>t=>n(t)===e,r=e=>t=>typeof t===e,o=l("string"),i=l("object"),a=l("array"),s=e=>null===e,u=r("boolean"),c=e=>null==e,g=e=>!c(e),d=r("function"),m=(e,t)=>{if(a(e)){for(let n=0,l=e.length;n<l;++n)if(!t(e[n]))return!1;return!0}return!1},h=()=>{},f=e=>()=>e,p=(e,t)=>e===t;class k{constructor(e,t){this.tag=e,this.value=t}static some(e){return new k(!0,e)}static none(){return k.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?k.some(e(this.value)):k.none()}bind(e){return this.tag?e(this.value):k.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:k.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return g(e)?k.some(e):k.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}k.singletonNone=new k(!1);let v=Array.prototype.indexOf,y=Array.prototype.push,x=(e,t)=>v.call(e,t),b=(e,t)=>x(e,t)>-1,_=(e,t)=>{let n=e.length,l=Array(n);for(let r=0;r<n;r++){let n=e[r];l[r]=t(n,r)}return l},w=(e,t)=>{for(let n=0,l=e.length;n<l;n++){let l=e[n];t(l,n)}},C=(e,t,n)=>(w(e,(e,l)=>{n=t(n,e,l)}),n),O=e=>{let t=[];for(let n=0,l=e.length;n<l;++n){if(!a(e[n]))throw Error("Arr.flatten item "+n+" was not an array, input: "+e);y.apply(t,e[n])}return t},N=(e,t)=>O(_(e,t)),A=(e,t)=>{for(let n=0;n<e.length;n++){let l=t(e[n],n);if(l.isSome())return l}return k.none()},T=(e,t,n=p)=>e.exists(e=>n(e,t)),S=e=>{let t=[],n=e=>{t.push(e)};for(let t=0;t<e.length;t++)e[t].each(n);return t},E=(e,t)=>e?k.some(t):k.none(),R=e=>t=>t.options.get(e),L=e=>{let t=e.options.register;t("link_assume_external_targets",{processor:e=>{let t=o(e)||u(e);return t?!0===e?{value:1,valid:t}:"http"===e||"https"===e?{value:e,valid:t}:{value:0,valid:t}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),t("link_context_toolbar",{processor:"boolean",default:!1}),t("link_list",{processor:e=>o(e)||d(e)||m(e,i)}),t("link_default_target",{processor:"string"}),t("link_default_protocol",{processor:"string",default:"https"}),t("link_target_list",{processor:e=>u(e)||m(e,i),default:!0}),t("link_rel_list",{processor:"object[]",default:[]}),t("link_class_list",{processor:"object[]",default:[]}),t("link_title",{processor:"boolean",default:!0}),t("allow_unsafe_link_target",{processor:"boolean",default:!1}),t("link_quicklink",{processor:"boolean",default:!1})},P=R("link_assume_external_targets"),M=R("link_context_toolbar"),D=R("link_list"),U=R("link_default_target"),B=R("link_default_protocol"),I=R("link_target_list"),j=R("link_rel_list"),K=R("link_class_list"),q=R("link_title"),z=R("allow_unsafe_link_target"),F=R("link_quicklink");var V=tinymce.util.Tools.resolve("tinymce.util.Tools");let W=e=>o(e.value)?e.value:"",$=e=>o(e.text)?e.text:o(e.title)?e.title:"",G=(e,t)=>{let n=[];return V.each(e,e=>{let l=$(e);if(void 0!==e.menu){let r=G(e.menu,t);n.push({text:l,items:r})}else{let r=t(e);n.push({text:l,value:r})}}),n},H=(e=W)=>t=>k.from(t).map(t=>G(t,e)),J=e=>H(W)(e),Q=(e,t)=>n=>({name:e,type:"listbox",label:t,items:n}),X={sanitize:J,sanitizeWith:H,createUi:Q,getValue:W},Y=Object.keys,Z=Object.hasOwnProperty,ee=(e,t)=>{let n=Y(e);for(let l=0,r=n.length;l<r;l++){let r=n[l],o=e[r];t(o,r)}},et=e=>(t,n)=>{e[n]=t},en=(e,t,n,l)=>{ee(e,(e,r)=>{(t(e,r)?n:l)(e,r)})},el=(e,t)=>{let n={};return en(e,t,et(n),h),n},er=(e,t)=>Z.call(e,t),eo=(e,t)=>er(e,t)&&void 0!==e[t]&&null!==e[t];var ei=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),ea=tinymce.util.Tools.resolve("tinymce.util.URI");let es=e=>g(e)&&"a"===e.nodeName.toLowerCase(),eu=e=>es(e)&&!!ed(e),ec=(e,t)=>{if(e.collapsed)return[];{let n=e.cloneContents(),l=n.firstChild,r=new ei(l,n),o=[],i=l;do t(i)&&o.push(i);while(i=r.next());return o}},eg=e=>/^\w+:/i.test(e),ed=e=>{var t,n;return null!==(n=null!==(t=e.getAttribute("data-mce-href"))&&void 0!==t?t:e.getAttribute("href"))&&void 0!==n?n:""},em=(e,t)=>{var n;let l=["noopener"],r=e?e.split(/\s+/):[],o=e=>e.filter(e=>-1===V.inArray(l,e)),i=t?(n=o(n=r)).length>0?n.concat(l):l:o(r);return i.length>0?V.trim(i.sort().join(" ")):""},eh=e=>e.replace(/\uFEFF/g,""),ef=(e,t)=>eb(t=t||e.selection.getNode())?k.from(e.dom.select("a[href]",t)[0]):k.from(e.dom.getParent(t,"a[href]")),ep=(e,t)=>ef(e,t).isSome(),ek=(e,t)=>{let n=t.fold(()=>e.getContent({format:"text"}),e=>e.innerText||e.textContent||"");return eh(n)},ev=e=>V.grep(e,eu).length>0,ey=e=>ec(e,eu).length>0,ex=e=>{let t=e.schema.getTextInlineElements(),n=e=>1===e.nodeType&&!es(e)&&!er(t,e.nodeName.toLowerCase()),l=ef(e).exists(e=>e.hasAttribute("data-mce-block"));if(l)return!1;let r=e.selection.getRng();if(r.collapsed)return!0;{let e=ec(r,n);return 0===e.length}},eb=e=>g(e)&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className),e_=e=>C(["title","rel","class","target"],(t,n)=>(e[n].each(e=>{t[n]=e.length>0?e:null}),t),{href:e.href}),ew=(e,t)=>"http"!==t&&"https"!==t||eg(e)?e:t+"://"+e,eC=(e,t)=>{let n={...t};if(0===j(e).length&&!z(e)){let e=em(n.rel,"_blank"===n.target);n.rel=e||null}return k.from(n.target).isNone()&&!1===I(e)&&(n.target=U(e)),n.href=ew(n.href,P(e)),n},eO=(e,t,n,l)=>{n.each(e=>{er(t,"innerText")?t.innerText=e:t.textContent=e}),e.dom.setAttribs(t,l),e.selection.select(t)},eN=(e,t,n,l)=>{let r=e.dom;eb(t)?eD(r,t,l):n.fold(()=>{e.execCommand("mceInsertLink",!1,l)},t=>{e.insertContent(r.createHTML("a",l,r.encode(t)))})},eA=(e,t,n)=>{let l=e.selection.getNode(),r=ef(e,l),o=eC(e,e_(n));e.undoManager.transact(()=>{n.href===t.href&&t.attach(),r.fold(()=>{eN(e,l,n.text,o)},t=>{e.focus(),eO(e,t,n.text,o)})})},eT=e=>{let t=e.dom,n=e.selection,l=n.getBookmark(),r=n.getRng().cloneRange(),o=t.getParent(r.startContainer,"a[href]",e.getBody()),i=t.getParent(r.endContainer,"a[href]",e.getBody());o&&r.setStartBefore(o),i&&r.setEndAfter(i),n.setRng(r),e.execCommand("unlink"),n.moveToBookmark(l)},eS=e=>{e.undoManager.transact(()=>{let t=e.selection.getNode();eb(t)?eM(e,t):eT(e),e.focus()})},eE=e=>{let{class:t,href:n,rel:l,target:r,text:o,title:i}=e;return el({class:t.getOrNull(),href:n,rel:l.getOrNull(),target:r.getOrNull(),text:o.getOrNull(),title:i.getOrNull()},(e,t)=>!1===s(e))},eR=(e,t)=>{let n=e.options.get,l={allow_html_data_urls:n("allow_html_data_urls"),allow_script_urls:n("allow_script_urls"),allow_svg_data_urls:n("allow_svg_data_urls")},r=t.href;return{...t,href:ea.isDomSafe(r,"a",l)?r:""}},eL=(e,t,n)=>{let l=eR(e,n);e.hasPlugin("rtc",!0)?e.execCommand("createlink",!1,eE(l)):eA(e,t,l)},eP=e=>{e.hasPlugin("rtc",!0)?e.execCommand("unlink"):eS(e)},eM=(e,t)=>{var n;let l=e.dom.select("img",t)[0];if(l){let r=e.dom.getParents(l,"a[href]",t)[0];r&&(null===(n=r.parentNode)||void 0===n||n.insertBefore(l,r),e.dom.remove(r))}},eD=(e,t,n)=>{var l;let r=e.select("img",t)[0];if(r){let t=e.create("a",n);null===(l=r.parentNode)||void 0===l||l.insertBefore(t,r),t.appendChild(r)}},eU=e=>eo(e,"items"),eB=(e,t)=>A(t,t=>eU(t)?eB(e,t.items):E(t.value===e,t)),eI=(e,t,n,l)=>{let r=l[t],o=e.length>0;return void 0!==r?eB(r,n).map(t=>({url:{value:t.value,meta:{text:o?e:t.text,attach:h}},text:o?e:t.text})):k.none()},ej=(e,t)=>"link"===t?e.link:"anchor"===t?e.anchor:k.none(),eK=(e,t)=>{let n={text:e.text,title:e.title},l=e=>{var t;return E(n.title.length<=0,k.from(null===(t=e.meta)||void 0===t?void 0:t.title).getOr(""))},r=e=>{var t;return E(n.text.length<=0,k.from(null===(t=e.meta)||void 0===t?void 0:t.text).getOr(e.value))},o=e=>{let t=r(e.url),n=l(e.url);return t.isSome()||n.isSome()?k.some({...t.map(e=>({text:e})).getOr({}),...n.map(e=>({title:e})).getOr({})}):k.none()},i=(e,l)=>{let r=ej(t,l).getOr([]);return eI(n.text,l,r,e)},a=(e,t)=>{let l=t.name;return"url"===l?o(e()):b(["anchor","link"],l)?i(e(),l):(("text"===l||"title"===l)&&(n[l]=e()[l]),k.none())};return{onChange:a}},eq={init:eK,getDelta:eI};var ez=tinymce.util.Tools.resolve("tinymce.util.Delay");let eF=(e,t,n)=>{let l=e.selection.getRng();ez.setEditorTimeout(e,()=>{e.windowManager.confirm(t,t=>{e.selection.setRng(l),n(t)})})},eV=e=>{let t=e.href,n=t.indexOf("@")>0&&-1===t.indexOf("/")&&-1===t.indexOf("mailto:");return n?k.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:e=>({...e,href:"mailto:"+t})}):k.none()},eW=(e,t)=>n=>{let l=n.href,r=1===e&&!eg(l)||0===e&&/^\s*www(\.|\d\.)/i.test(l);return r?k.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${t}:// prefix?`,preprocess:e=>({...e,href:t+"://"+l})}):k.none()},e$=(e,t)=>A([eV,eW(P(e),B(e))],e=>e(t)).fold(()=>Promise.resolve(t),n=>new Promise(l=>{eF(e,n.message,e=>{l(e?n.preprocess(t):t)})})),eG={preprocess:e$},eH=e=>{let t=e.dom.select("a:not([href])"),n=N(t,e=>{let t=e.name||e.id;return t?[{text:t,value:"#"+t}]:[]});return n.length>0?k.some([{text:"None",value:""}].concat(n)):k.none()},eJ={getAnchors:eH},eQ=e=>{let t=K(e);return t.length>0?X.sanitize(t):k.none()},eX={getClasses:eQ},eY=e=>{try{return k.some(JSON.parse(e))}catch(e){return k.none()}},eZ=e=>{let t=t=>e.convertURL(t.value||t.url||"","href"),n=D(e);return new Promise(e=>{o(n)?fetch(n).then(e=>e.ok?e.text().then(eY):Promise.reject()).then(e,()=>e(k.none())):d(n)?n(t=>e(k.some(t))):e(k.from(n))}).then(e=>e.bind(X.sanitizeWith(t)).map(e=>e.length>0?[{text:"None",value:""}].concat(e):e))},e0={getLinks:eZ},e1=(e,t)=>{let n=j(e);if(n.length>0){let l=T(t,"_blank"),r=!1===z(e),o=e=>em(X.getValue(e),l),i=r?X.sanitizeWith(o):X.sanitize;return i(n)}return k.none()},e3={getRels:e1},e2=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],e4=e=>{let t=I(e);return a(t)?X.sanitize(t).orThunk(()=>k.some(e2)):!1===t?k.none():k.some(e2)},e5={getTargets:e4},e6=(e,t,n)=>{let l=e.getAttrib(t,n);return null!==l&&l.length>0?k.some(l):k.none()},e7=(e,t)=>{let n=e.dom,l=ex(e),r=l?k.some(ek(e.selection,t)):k.none(),o=t.bind(e=>k.from(n.getAttrib(e,"href"))),i=t.bind(e=>k.from(n.getAttrib(e,"target"))),a=t.bind(e=>e6(n,e,"rel")),s=t.bind(e=>e6(n,e,"class")),u=t.bind(e=>e6(n,e,"title"));return{url:o,text:r,title:u,target:i,rel:a,linkClass:s}},e8=(e,t)=>e0.getLinks(e).then(n=>{let l=e7(e,t);return{anchor:l,catalogs:{targets:e5.getTargets(e),rels:e3.getRels(e,l.target),classes:eX.getClasses(e),anchor:eJ.getAnchors(e),link:n},optNode:t,flags:{titleEnabled:q(e)}}}),e9={collect:e8},te=(e,t)=>n=>{let l=n.getData();if(!l.url.value){eP(e),n.close();return}let r=e=>k.from(l[e]).filter(n=>!T(t.anchor[e],n)),o={href:l.url.value,text:r("text"),target:r("target"),rel:r("rel"),class:r("linkClass"),title:r("title")},i={href:l.url.value,attach:void 0!==l.url.meta&&l.url.meta.attach?l.url.meta.attach:h};eG.preprocess(e,o).then(t=>{eL(e,i,t)}),n.close()},tt=e=>{let t=ef(e);return e9.collect(e,t)},tn=(e,t)=>{let n=e.anchor,l=n.url.getOr("");return{url:{value:l,meta:{original:{value:l}}},text:n.text.getOr(""),title:n.title.getOr(""),anchor:l,link:l,rel:n.rel.getOr(""),target:n.target.or(t).getOr(""),linkClass:n.linkClass.getOr("")}},tl=(e,t,n)=>{let l=e.anchor.text.map(()=>({name:"text",type:"input",label:"Text to display"})).toArray(),r=e.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],o=k.from(U(n)),i=tn(e,o),a=e.catalogs,s=eq.init(i,a),u={type:"panel",items:O([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],l,r,S([a.anchor.map(X.createUi("anchor","Anchors")),a.rels.map(X.createUi("rel","Rel")),a.targets.map(X.createUi("target","Open link in...")),a.link.map(X.createUi("link","Link list")),a.classes.map(X.createUi("linkClass","Class"))])])};return{title:"Insert/Edit Link",size:"normal",body:u,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:i,onChange:(e,{name:t})=>{s.onChange(e.getData,{name:t}).each(t=>{e.setData(t)})},onSubmit:t}},tr=e=>{let t=tt(e);t.then(t=>{let n=te(e,t);return tl(t,n,e)}).then(t=>{e.windowManager.open(t)})},to=e=>{e.addCommand("mceLink",(t,n)=>{(null==n?void 0:n.dialog)!==!0&&F(e)?e.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"}):tr(e)})};var ti=tinymce.util.Tools.resolve("tinymce.util.VK");let ta=(e,t)=>{document.body.appendChild(e),e.dispatchEvent(t),document.body.removeChild(e)},ts=e=>{let t=document.createElement("a");t.target="_blank",t.href=e,t.rel="noreferrer noopener";let n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),ta(t,n)},tu=(e,t)=>e.dom.getParent(t,"a[href]"),tc=e=>tu(e,e.selection.getStart()),tg=e=>!0===e.altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey,td=(e,t)=>{if(t){let n=ed(t);if(/^#/.test(n)){let t=e.dom.select(n);t.length&&e.selection.scrollIntoView(t[0],!0)}else ts(t.href)}},tm=e=>()=>{e.execCommand("mceLink",!1,{dialog:!0})},th=e=>()=>{td(e,tc(e))},tf=e=>{e.on("click",t=>{let n=tu(e,t.target);n&&ti.metaKeyPressed(t)&&(t.preventDefault(),td(e,n))}),e.on("keydown",t=>{if(!t.isDefaultPrevented()&&13===t.keyCode&&tg(t)){let n=tc(e);n&&(t.preventDefault(),td(e,n))}})},tp=(e,t)=>(e.on("NodeChange",t),()=>e.off("NodeChange",t)),tk=e=>t=>{let n=()=>t.setActive(!e.mode.isReadOnly()&&ep(e,e.selection.getNode()));return n(),tp(e,n)},tv=e=>t=>{let n=()=>t.setEnabled(ep(e,e.selection.getNode()));return n(),tp(e,n)},ty=e=>t=>{let n=t=>ev(t)||ey(e.selection.getRng()),l=e.dom.getParents(e.selection.getStart());return t.setEnabled(n(l)),tp(e,e=>t.setEnabled(n(e.parents)))},tx=e=>{e.addShortcut("Meta+K","",()=>{e.execCommand("mceLink")})},tb=e=>{e.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:tm(e),onSetup:tk(e)}),e.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:th(e),onSetup:tv(e)}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>eP(e),onSetup:ty(e)})},t_=e=>{e.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:th(e),onSetup:tv(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:tm(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>eP(e),onSetup:ty(e)})},tw=e=>{e.ui.registry.addContextMenu("link",{update:t=>ev(e.dom.getParents(t,"a"))?"link unlink openlink":"link"})},tC=e=>{let t=e=>{e.selection.collapse(!1)},n=t=>{let n=e.selection.getNode();return t.setEnabled(ep(e,n)),h},l=t=>{let n=ef(e),l=ex(e);if(!n.isNone()||!l)return k.none();{let l=ek(e.selection,n);return k.some(l.length>0?l:t)}};e.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:tk(e)},label:"Link",predicate:t=>M(e)&&ep(e,t),initValue:()=>{let t=ef(e);return t.fold(f(""),ed)},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:t=>{let n=e.selection.getNode();return t.setActive(ep(e,n)),tk(e)(t)},onAction:n=>{let r=n.getValue(),o=l(r);eL(e,{href:r,attach:h},{href:r,text:o,title:k.none(),rel:k.none(),target:k.none(),class:k.none()}),t(e),n.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:n,onAction:t=>{eP(e),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:n,onAction:t=>{th(e)(),t.hide()}}]})};e.add("link",e=>{L(e),tb(e),t_(e),tw(e),tC(e),tf(e),to(e),tx(e)})}();